---
- name: "Core Base config"
  hosts: core
  connection: network_cli

  tasks:
    - name: "Configuring core routers base config"
      cli_config:
        config: "{{lookup('template','core_base_template.j2')}}"

- name: "Switch Base Config"
  hosts: switch
  connection: network_cli

  tasks:
    - name: "Configuring switch base config"
      cli_config:
        config: "{{lookup('template','switch_base_template.j2')}}"

- name: "Firewall Base Config"
  hosts: firewall

  tasks:
    - name: "Configuring firewall base config"
      blockinfile:
        block: "{{ lookup('template','fw_base_template.j2') }}"
        path: /etc/network/interfaces
    - name: "Enable interfaces"
      command: ifconfig "{{item}}" up
      loop: {{interfaces | map(attribute='name') | list}}

- name: "Customer router config"
  hosts: customer
  connection: network_cli

  tasks:
    - name: "Building directory space"
      include_tasks: deploy/tasks/build_config_directory.yml

    - name: "Building customer config"
      include_tasks: deploy/tasks/prep_cust_config.yml

    - name: "Push customer config"
      include_tasks: deploy/tasks/push_cust_rtr_config.yml

- name: "Configuring Switch for customer"
  hosts: switch
  connection: network_cli

  tasks:
    - name: "Preparing switch config"
      include_tasks: deploy/tasks/prep_switch_cust_config.yml

    - name: "Push switch config"
      include_tasks: deploy/tasks/push_switch_cust_config.yml


- name: "Configuring Core  for customer"
  hosts: core
  connection: network_cli

  tasks:
    - name: "Preparing core config"
      include_tasks: deploy/tasks/prep_core_rtr_cust_config.yml

    - name: "Push core config"
      include_tasks: deploy/tasks/push_core_rtr_cust_config.yml

